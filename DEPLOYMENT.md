# Deployment Guide - Poossh Stamp Merchant Portal

## Quick Deploy to Render

### Option 1: Using Render Dashboard (Recommended)

1. **Push code to GitHub**
   ```bash
   cd /Users/lailaparedes/OfficialStamp/webpage
   git init
   git add .
   git commit -m "Initial commit - Poossh Stamp Merchant Portal"
   git remote add origin <your-github-repo-url>
   git push -u origin main
   ```

2. **Connect to Render**
   - Go to [Render Dashboard](https://dashboard.render.com)
   - Click **"New +"** â†’ **"Web Service"**
   - Connect your GitHub repository
   - Render will auto-detect `render.yaml`

3. **Configure Environment Variables**
   In Render dashboard, add:
   ```
   SUPABASE_URL=your_supabase_url
   SUPABASE_ANON_KEY=your_supabase_anon_key
   JWT_SECRET=<auto-generated by Render>
   PORT=3000
   NODE_ENV=production
   ```

4. **Deploy!**
   - Click **"Create Web Service"**
   - Render will automatically build and deploy
   - Your site will be live at: `https://poossh-stamp-merchant-portal.onrender.com`

---

### Option 2: Using Render Blueprint (Faster)

1. **Push to GitHub** (same as above)

2. **Deploy with Blueprint**
   - Go to Render Dashboard
   - Click **"New +"** â†’ **"Blueprint"**
   - Connect your repo
   - Render reads `render.yaml` automatically
   - Add environment variables
   - Click **"Apply"**

---

## Manual Deployment Steps

### Build Commands
```bash
# Install root dependencies (Express, etc.)
npm install

# Install frontend dependencies and build
cd frontend && npm install && npm run build && cd ..
```

### Start Command
```bash
node server.js
```

### Environment Variables Needed
```
SUPABASE_URL=https://your-project.supabase.co
SUPABASE_ANON_KEY=your-anon-key
JWT_SECRET=generate-a-secure-random-string
PORT=3000
NODE_ENV=production
```

---

## Health Check

Render will ping: `GET /api/merchants/all`

Make sure this endpoint returns 200 OK.

---

## Custom Domain (Optional)

1. In Render dashboard â†’ Your service â†’ **"Settings"**
2. Scroll to **"Custom Domain"**
3. Add your domain: `merchants.poossh-stamp.com`
4. Update DNS records as instructed
5. SSL certificate auto-generated!

---

## Scaling

**Free Tier:**
- âœ… Good for testing
- âš ï¸ Sleeps after 15 minutes of inactivity
- âš ï¸ 750 hours/month

**Starter Tier ($7/month):**
- âœ… No sleeping
- âœ… Better performance
- âœ… Custom domains

**Production Tier:**
- Upgrade as needed
- Auto-scaling available

---

## Database Migrations

Run SQL migrations in Supabase before deploying:

```sql
-- 1. Add qr_code column
ALTER TABLE merchants ADD COLUMN IF NOT EXISTS qr_code TEXT;

-- 2. Add qr_code_id column
ALTER TABLE merchants ADD COLUMN IF NOT EXISTS qr_code_id UUID;
CREATE INDEX IF NOT EXISTS idx_merchants_qr_code_id ON merchants(qr_code_id);

-- 3. Add multiple merchants support
ALTER TABLE merchants ADD COLUMN IF NOT EXISTS created_by UUID REFERENCES merchant_portal_users(id);
ALTER TABLE merchants ADD COLUMN IF NOT EXISTS is_active BOOLEAN DEFAULT true;
ALTER TABLE merchants ADD COLUMN IF NOT EXISTS common_merchant_id TEXT;
```

---

## Post-Deployment Checklist

- [ ] Environment variables set correctly
- [ ] Database migrations run in Supabase
- [ ] Health check endpoint working
- [ ] Login with test account works
- [ ] QR code generation works
- [ ] Dashboard displays data correctly
- [ ] Custom domain configured (if applicable)

---

## Troubleshooting

### Build fails
```bash
# Check build logs in Render dashboard
# Common fixes:
- Ensure Node.js version >= 18
- Check package.json scripts
- Verify all dependencies installed
```

### App crashes on start
```bash
# Check environment variables
# Ensure SUPABASE_URL and SUPABASE_ANON_KEY are set
# Verify PORT is set to 3000
```

### 502 Bad Gateway
```bash
# Server not starting properly
# Check start command: node backend/server.js
# Check logs for errors
```

---

## Monitoring

View logs in Render:
- **Dashboard** â†’ Your service â†’ **"Logs"**
- Real-time log streaming
- Search and filter logs

---

## Automatic Deployments

Every push to `main` branch triggers auto-deployment!

```bash
git add .
git commit -m "Update feature"
git push origin main
# ðŸš€ Render automatically deploys!
```

---

## Cost Estimate

| Plan | Cost | Best For |
|------|------|----------|
| Free | $0 | Testing/Development |
| Starter | $7/mo | Small businesses |
| Pro | $25/mo | Growing businesses |

**Recommendation:** Start with Free tier, upgrade to Starter when ready for production.
